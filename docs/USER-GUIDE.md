# User documentation

The E-Commerce migation tool has been created for migrating categories and products from any e-commerce system to another. Therefore you need to configure the source and destination.

## Usage

You can start the application via:

```
java ecommerce-utils-1.0.0-SNAPSHOT.jar <action> --config=configuration-file>
```

### Merging categories
For merging categories the required command looks like following:

```
java ecommerce-utils-1.0.0-SNAPSHOT.jar --merge-categories --config=<PATH-TO-CONFIGURATION>/migration-config.yaml
```

### Merging products
For merging products the required command looks like following:

```
java ecommerce-utils-1.0.0-SNAPSHOT.jar --merge-products --config=<PATH-TO-CONFIGURATION>/migration-config.yaml
```

## Prepare connectors configuration

The connection details will be configured in the **application.properties** due to the underlying spring boot technology. Currently a very simple implementation has been done which is able to read from **magento2** and write to **prestashop17**. Additional read and write connectors can be added easily.

```
  migration.magento2.base-url=http://data-migration-magento.local/index.php
  migration.magento2.user=admin
  migration.magento2.password=<password>

  migration.prestashop17.base-url=http://prestashop.local/api
  migration.prestashop17.auth-token=WUIHXDKPX2WNUUBLAG6BLZ8FIAX6PM6P
  migration.prestashop17.base-category-id=1
```

## Migration configuration

### Migrating and merging categories to new system

```
  java <JAR-FILE-NAME-TODO>.jar --merge-categories --config=<PATH-TO-CONFIGURATION>/migration-config.yaml
```

The main configuration file **migration-config.yaml** looks like following:

```
  # migration configuration file: migration-config.yaml
  ---
  source-system-name: magento2
  destination-system-name: prestashop17
  root-category-id: 1
  root-category-language: en
  additional-categories:
    -
      category-id: 11
      category-language: de
  categories-mapping-file: /absolut/path/config/category-mapping.properties
  category-ids-merging-ignore-list:
    - 53
    - 127
    - 128
    - 126
    - 78
  category-ids-skipping:
  #  - 50
```

// TODO: add additional description for configuration file

> If the migration tool is not able to map a category the migration process will be aborted and the failing categories will be printed out.


#### Categories merging configuration file: category-mapping.properties

Let's assume we have on our source system category trees for an english and italian categories root tree as following:

```
  # English categories
  1: English categories
    2: Men
      4: Pants
      5: Shoes
    3: Women
      6: Pants
      7: Shoes

  # German categories
  11: German categories
    12: MÃ¤nner
      14: Hosen
      15: Schuhe
    13: Frauen
      16: Hosen
      17: Schuhe
```

For merging category root trees of different languages to a single multi-language category tree in the destination system the file **category-mapping.properties** will be used.

The file follows the following syntax:
```
sourceCategoryId=destinationCategoryId
```

For the example above to merge german categories to english categories the mapping file looks as following:
```
  # category merging ids mapping
  # secondaryCategoryId=mainCategoryId
  11=1
  12=2
  13=3
  14=4
  15=5
  16=6
  17=7
```

### Map products to main multilanguage product

To generate a mapping file for merge products from secondary languages to the main languages this command needs to be called. Currently we assume that the secondary languages are represanted with the same sku as the main product only with a "_" as prefix. Additional mapper needs to be added if this is not in your case like this.

```
java <JAR-FILE-NAME-TODO>.jar --products-mapping --config=<PATH-TO-CONFIGURATION>/migration-config.yaml
```

As a result the file configured in **migration-config.yaml** with parameter-name **generated-products-merging-file** will be generated. To support manual mapping beforehand users can define premapped product ids using the parameter **products-merging-file**.

```
  # migration configuration file: migration-config.yaml
  ---
  source-system-name: magento2
  destination-system-name: prestashop17
  root-category-id: 1
  root-category-language: en
  additional-categories:
    -
      category-id: 11
      category-language: de
  products-merging-file: <path/to/file>/config/products-merging.properties
  generated-products-merging-file: <path/to/file>/config/generated/generated-products-merging.properties
```

This files can also be generated by external tools or manually and will be used in the next step 

### Migrating products to new system

Using the productId-mapping from products-mappin

```
java <JAR-FILE-NAME-TODO>.jar --merge-products --config=<PATH-TO-CONFIGURATION>/migration-config.yaml
```